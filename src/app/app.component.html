<div class="container">
  <div class="row mt-3">
    <div class="col-6">
      <h2>Dashboard</h2>
    </div>
    <div class="col-6">
      <button class="btn btn-success" (click)="showModal.show = true; showModal.addOrEdit = false; setNewUser()">Create User</button>
      <button class="btn btn-primary ml-2" *ngIf="!filesPage" (click)="filesPage = true; getFiles()">Files</button>
      <button class="btn btn-primary ml-2" *ngIf="filesPage" (click)="filesPage = false">Users</button>
    </div>
  </div>
  <div *ngIf="!filesPage" class="row">
    <div class="col-3">
      <div class="form-group">
        <label for="name">Name</label>
        <input type="text" class="form-control" id="name" name="search-name" [(ngModel)]="search.name" (keyup)="searchUsers()">
      </div>
    </div>
    <div class="col-3">
      <div class="form-group">
        <label for="email">Email</label>
        <input type="text" class="form-control" id="email" name="search-email" [(ngModel)]="search.email" (keyup)="searchUsers()">
      </div>
    </div>
    <div class="col-2">
      <div class="form-group">
        <label for="dobMin">DOB Min</label>
        <input type="date" class="form-control" id="dobMin" name="search-dobMin" [(ngModel)]="search.dobMin" (change)="searchUsers()">
      </div>
    </div>
    <div class="col-2">
      <div class="form-group">
        <label for="dobMax">DOB Max</label>
        <input type="date" class="form-control" id="dobMax" name="search-dobMax" [(ngModel)]="search.dobMax" (change)="searchUsers()">
      </div>
    </div>
    <div class="col-2">
      <div class="form-group">
        <label for="status">Status</label>
        <select name="status" class="form-control" id="status" name="search-status" [(ngModel)]="search.status" (change)="searchUsers()">
          <option value="" disabled selected>Select Status</option>
          <option value="lead">Lead</option>
          <option value="demo">Demo</option>
          <option value="client">Client</option>
        </select>
      </div>
    </div>
  </div>

  <div *ngIf="!filesPage" class="row">
    <div class="col-12" *ngIf="users && users.length > 0">
      <table class="table table-striped">
        <thead>
        <tr>
          <th scope="col">#</th>
          <th scope="col">FirstName/LastName</th>
          <th scope="col">Email</th>
          <th scope="col">DOB</th>
          <th scope="col">Edit</th>
          <th scope="col">Delete</th>
        </tr>
        </thead>
        <tbody>
        <tr *ngFor="let us of users; let i = index">
          <th scope="row">{{i+1}}</th>
          <td>{{us.firstName}} {{us.lastName}}</td>
          <td>{{us.email}}</td>
          <td>{{us.birthDate | date: 'MM/dd/yyyy'}}</td>
          <td>
            <button class="btn btn-primary" (click)="showModal.show = true; showModal.addOrEdit = true; userId = us.id; getUser()">
              <i class="fas fa-pencil-alt"></i>
            </button>
          </td>
          <td>
            <button class="btn btn-danger" (click)="deleteUser = true; userId = us.id">
              <i class="fas fa-trash-alt"></i>
            </button>
          </td>
        </tr>
        </tbody>
      </table>
    </div>
    <div class="col-12" *ngIf="!users || users.length === 0">
      <p>No data</p>
    </div>
  </div>

  <div *ngIf="filesPage" class="row">
    <div class="col-12">
      <div class="form-group">
        <label for="files-user-status">Status</label>
        <select name="status" class="form-control" id="files-user-status" name="search-status" [(ngModel)]="search.status" (change)="getFiles()">
          <option value="" disabled selected>Select Status</option>
          <option value="lead">Lead</option>
          <option value="demo">Demo</option>
          <option value="client">Client</option>
        </select>
      </div>
    </div>

    <div class="col-12">
      <div class="row">
        <div class="col-2 p-2" *ngFor="let img of allFiles">
          <div *ngIf="img">
            <div class="border rounded">
              <img src="{{apiUrl + '/' + img.filename + '.' + img.mime}}" alt="" class="img-thumbnail">
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!--Add or Edit Modal-->

<div class="modal fade bd-example-modal-lg" *ngIf="user" [ngClass]="showModal.show ? 'show' : ''" [ngStyle]="{'display' : showModal.show ? 'block': 'none'}">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel">New message</h5>
        <button type="button" class="close"  (click)="showModal.show = false; userId = null">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <div class="row">
          <div class="col-4">
            <div class="form-group">
              <label for="user-firstName">Firstname</label>
              <input type="text" name="user-firstName" id="user-firstName" class="form-control" [(ngModel)]="user.firstName">
              <p class="text-danger" *ngIf="validation.firstName">Firstname is required</p>
            </div>
          </div>
          <div class="col-4">
            <div class="form-group">
              <label for="user-lastName">Lastname</label>
              <input type="text" name="user-lastName" id="user-lastName" class="form-control" [(ngModel)]="user.lastName">
              <p class="text-danger" *ngIf="validation.lastName">Lasstname is required</p>
            </div>
          </div>
          <div class="col-4">
            <div class="form-group">
              <label for="user-email">Email</label>
              <input type="text" name="user-email" id="user-email" class="form-control" [(ngModel)]="user.email">
              <p class="text-danger" *ngIf="validation.email">Email is required and must be valid email</p>
            </div>
          </div>
          <div class="col-4">
            <div class="form-group">
              <label for="user-birthDate">DOB</label>
              <input type="date"
                     placeholder="mm/dd/yyyy"
                     name="user-birthDate"
                     id="user-birthDate"
                     class="form-control"
                     (ngModelChange)="user.birthDate = $event"
                     [ngModel]="user.birthDate | date:'yyyy-MM-dd'">
              <p class="text-danger" *ngIf="validation.birthDate">Dob is required</p>
            </div>
          </div>
          <div class="col-4">
            <div class="form-group">
              <label for="user-ipAddress">IP Address</label>
              <input type="text" name="user-ipAddress" id="user-ipAddress" class="form-control" [(ngModel)]="user.ipAddress">
              <p class="text-danger" *ngIf="validation.ipAddress">Ip Address is required</p>
            </div>
          </div>
          <div class="col-4">
            <div class="form-group">
              <label for="user-status">Status</label>
              <select name="user-status" id="user-status" class="form-control" [(ngModel)]="user.status">
                <option value="lead" selected>Lead</option>
                <option value="demo">Demo</option>
                <option value="client">Client</option>
              </select>
            </div>
          </div>
        </div>
        <div class="row">
          <div class="col-12">
            <p class="text-danger" *ngIf="imgSize && imgSize > 10000000">File Size must be max 10Mb</p>
          </div>
          <div class="col-2 p-2">
            <label for="photo" class="border label-gallery w-100">
              <img src="../assets/gallery-icon.png" alt="" class="img-fluid" >
              <input type="file" class="d-none" id="photo" (change)="onChange($event)">
            </label>
          </div>
          <div class="col-2" *ngIf="imageSrc">
            <div >
              <i class="fas fa-close-alt"></i>
              <div class="border rounded">
                <img src="{{imageSrc}}" alt="" class="img-thumbnail">
              </div>
            </div>
          </div>
          <div class="col-2 p-2" *ngFor="let img of user.Files">
            <div *ngIf="img">
              <i class="fas fa-times text-danger deleteImage" (click)="imageId = img.id; showDeleteImgModal = true"></i>
              <div class="border rounded">
                <img src="{{apiUrl + '/' + img.filename + '.' + img.mime}}" alt="" class="img-thumbnail">
              </div>
            </div>
          </div>
        </div>
        <div class="delete-image-modal" [ngStyle]="{'display' : showDeleteImgModal ? 'block': 'none'}">
          <div class="delete-image-modal-content">
            <h3 class="text-light">Are You Sure!!</h3>
            <div class="delete-image-modal-content__buttons mt-3">
              <button class="btn btn-danger" (click)="deletImage(); imageId = null; showDeleteImgModal = false">Yes</button>
              <button class="btn btn-success ml-4" (click)=" imageId = null; showDeleteImgModal = false">No</button>
            </div>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" (click)="showModal.show = false; userId = null">Close</button>
        <button type="button" class="btn btn-primary" (click)="createUser()">Save</button>
      </div>
    </div>
  </div>
</div>

<!--delete user modal-->

<div class="modal fade bd-example-modal-sm"  [ngClass]="deleteUser ? 'show' : ''" [ngStyle]="{'display' : deleteUser ? 'block': 'none'}">
  <div class="modal-dialog modal-sm">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel1">Delete User</h5>
        <button type="button" class="close"  (click)="showModal.show = false; userId = null">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        ....
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" (click)="deleteUser = false; userId = null">Close</button>
        <button type="button" class="btn btn-primary" (click)="userId = null">Save</button>
      </div>
    </div>
  </div>
</div>

<!--modal background-->
<div class="modal-backdrop fade "
     [ngClass]="showModal.show || deleteUser ? 'show' : ''"
     [ngStyle]="{'display' : showModal.show || deleteUser ? 'block': 'none'}"></div>
